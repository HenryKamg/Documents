# 查看计量项的统计 #

一个时间段（Period）内的 samples 聚合值，包括计数（Count）、最大（Max）、最小（Min）、平均 （Avg）、求和（Sum）等。

## 用法 ##

`ceilometer statistics [-q <QUERY>] -m <NAME> [-p <PERIOD>] [-a <FUNC>]`

必选参数：

`-m <NAME>`     要查询meter的name

可选参数：

`[-q <QUERY>]`

查询条件，具体可以参考 [基本使用](./basic_usage.md)

可选的条件属性有：

| attr | value eg |
| --- | --- |
| project_id | 5f3c266772b94980ac2629b1c9d773c6 |
| resource_id | 3708a98e-e856-4836-bc06-481d629942a4 |
| user_id | 7e2fff4edbad42869051c5e631ca2600 |
| timestamp | 2015-09-08T08:06:55 |

`-p <PERIOD>`

周期，后接数字，单位是s，如`-p 60`。

其意义就是把最长时间区间（最早开始统计时间点到最近统计时间点）按照这个周期进行划分，然后再对划分出来的各个区间进行统计，显示。

若不选用这个参数，默认不划分区，也就是只统计这个最大的区间。

`-a <FUNC>`

数据统计的聚合方法，可选的有:

| 可选 | 意义 |
| --- | --- |
| count | 时间点个数 |
| min | 最小值 |
| max | 最大值 |
| sum | 总和 |
| avg | 平均值 |
| stddev | Standard deviation,即标准差 |

## 示例 ##

* 获取某个vm运行时间的统计

```
# ceilometer statistics -m instance -q resource_id=6e4c4a95-329e-4859-a622-9d8865364a0a
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
| Period | Period Start        | Period End          | Max | Min | Avg | Sum  | Count | Duration | Duration Start      | Duration End        |
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
| 0      | 2015-09-08T08:06:53 | 2015-09-08T08:06:53 | 1.0 | 1.0 | 1.0 | 29.0 | 29    | 85829.0  | 2015-09-08T08:06:53 | 2015-09-09T07:57:22 |
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
```

其中，Period默认为0,即整个时间段；max、min等统计数据；Duration即总运行时长；

* 获取某个时间段内vm的运行时间统计

```
# ceilometer statistics -m instance -q "resource_id=6e4c4a95-329e-4859-a622-9d8865364a0a;timestamp>2015-09-08T12:06:53;timestamp<2015-09-09T07:57:22"
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
| Period | Period Start        | Period End          | Max | Min | Avg | Sum  | Count | Duration | Duration Start      | Duration End        |
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
| 0      | 2015-09-09T03:27:22 | 2015-09-09T03:27:22 | 1.0 | 1.0 | 1.0 | 27.0 | 27    | 15600.0  | 2015-09-09T03:27:22 | 2015-09-09T07:47:22 |
+--------+---------------------+---------------------+-----+-----+-----+------+-------+----------+---------------------+---------------------+
```


看其中的Duration总运行时长变为15600.0

* 获取某个vm某个时间段内，以1小时为周期，每个周期的cpu统计

```
# ceilometer statistics -m cpu -q "resource_id=6e4c4a95-329e-4859-a622-9d8865364a0a;timestamp>2015-09-08T08:06:51;timestamp<2015-09-09T08:06:51" -p 3600
+--------+---------------------+---------------------+-------------+-------------+-------------------+--------------+-------+----------+---------------------+---------------------+
| Period | Period Start        | Period End          | Max         | Min         | Avg               | Sum          | Count | Duration | Duration Start      | Duration End        |
+--------+---------------------+---------------------+-------------+-------------+-------------------+--------------+-------+----------+---------------------+---------------------+
| 3600   | 2015-09-08T08:06:51 | 2015-09-08T09:06:51 | 1.9062e+12  | 1.9062e+12  | 1.9062e+12        | 1.9062e+12   | 1     | 0.0      | 2015-09-08T08:06:54 | 2015-09-08T08:06:54 |
| 3600   | 2015-09-09T03:06:51 | 2015-09-09T04:06:51 | 2.50151e+12 | 2.48732e+12 | 2.4944925e+12     | 9.97797e+12  | 4     | 1799.0   | 2015-09-09T03:27:22 | 2015-09-09T03:57:21 |
| 3600   | 2015-09-09T04:06:51 | 2015-09-09T05:06:51 | 2.53069e+12 | 2.50634e+12 | 2.51862333333e+12 | 1.511174e+13 | 6     | 3000.0   | 2015-09-09T04:07:21 | 2015-09-09T04:57:21 |
| 3600   | 2015-09-09T05:06:51 | 2015-09-09T06:06:51 | 2.56067e+12 | 2.53548e+12 | 2.54837e+12       | 1.529022e+13 | 6     | 3000.0   | 2015-09-09T05:07:21 | 2015-09-09T05:57:21 |
| 3600   | 2015-09-09T06:06:51 | 2015-09-09T07:06:51 | 2.7837e+12  | 2.56526e+12 | 2.64474833333e+12 | 1.586849e+13 | 6     | 3001.0   | 2015-09-09T06:07:21 | 2015-09-09T06:57:22 |
| 3600   | 2015-09-09T07:06:51 | 2015-09-09T08:06:51 | 2.81629e+12 | 2.78909e+12 | 2.8029e+12        | 1.68174e+13  | 6     | 2999.0   | 2015-09-09T07:07:22 | 2015-09-09T07:57:21 |
+--------+---------------------+---------------------+-------------+-------------+-------------------+--------------+-------+----------+---------------------+---------------------+
```

如上，我们分析一下，我们知道数据是600s收集一次，这里设置周期为3600s，也就是说一个周期内使用了6次的统计数据。

第一条中，count为1次，说明可能中途中有5次数据没有收集到，可能是服务未正常启动；

第二条也有问题；

后面的正常；

* 获取某个vm某个时间段内，以1小时为周期，每个周期的cpu最大值统计

```
# ceilometer statistics -m cpu -q "resource_id=6e4c4a95-329e-4859-a622-9d8865364a0a;timestamp>2015-09-08T08:06:51;timestamp<2015-09-09T08:06:51" -p 3600 -a max
+--------+---------------------+---------------------+-------------+----------+---------------------+---------------------+
| Period | Period Start        | Period End          | Max         | Duration | Duration Start      | Duration End        |
+--------+---------------------+---------------------+-------------+----------+---------------------+---------------------+
| 3600   | 2015-09-08T08:06:51 | 2015-09-08T09:06:51 | 1.9062e+12  | 0.0      | 2015-09-08T08:06:54 | 2015-09-08T08:06:54 |
| 3600   | 2015-09-09T03:06:51 | 2015-09-09T04:06:51 | 2.50151e+12 | 1799.0   | 2015-09-09T03:27:22 | 2015-09-09T03:57:21 |
| 3600   | 2015-09-09T04:06:51 | 2015-09-09T05:06:51 | 2.53069e+12 | 3000.0   | 2015-09-09T04:07:21 | 2015-09-09T04:57:21 |
| 3600   | 2015-09-09T05:06:51 | 2015-09-09T06:06:51 | 2.56067e+12 | 3000.0   | 2015-09-09T05:07:21 | 2015-09-09T05:57:21 |
| 3600   | 2015-09-09T06:06:51 | 2015-09-09T07:06:51 | 2.7837e+12  | 3001.0   | 2015-09-09T06:07:21 | 2015-09-09T06:57:22 |
| 3600   | 2015-09-09T07:06:51 | 2015-09-09T08:06:51 | 2.81629e+12 | 2999.0   | 2015-09-09T07:07:22 | 2015-09-09T07:57:21 |
+--------+---------------------+---------------------+-------------+----------+---------------------+---------------------+

```
