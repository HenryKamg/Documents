# 验证 Neutron 的 FWaaS

|内容编号|内容名称|
|--------|--------|
|11|防火墙服务|


|测试编号|测试目的|操作|预期结果|实际结果|备注|Rally/Tempest/None|
|--------|--------|----|--------|--------|----|------------------|
|01011101|创建防火墙规则|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙规则】按钮进入；</li><li>进入防火墙规则创建界面，点击添加规则按钮弹出添加规则窗口；</li><li>填写防火墙名称“firewall-rule”，协议类型“TCP”，动作“允许”，目的端口“80”。</li></ol></li><li>CLI:<ol><li>登录到controller节点；</li><li>执行命令<code>neutron firewall-rule-create --protocol tcp --destination-port 80 --action allow</code>|<ul><li>UI:<ol><li>创建防火墙规则成功。</li></ol></li><li>CLI:<ol><li>创建防火墙规则成功。||协议类型以及端口号可以根据需求选择|||
|01011102|创建防火墙策略|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙策略】按钮进入；</li><li>进入防火墙策略创建界面，点击增加策略按钮弹出增加策略窗口；</li><li>名称填写“firewall-policy”，点击规则按钮，将创建好的规则在可规则栏拖入选定规则栏，点击添加按钮，策略创建成功。</li></ol></li><li>CLI:<ol><li>登录到controller节点上</li><li>执行命令：<code>neutron firewall-policy-create --firewall-rules "FIREWALL-RULE-ID" policy1</code>|<ul><li>UI:<ol><li>创建防火墙策略成功。</li></ol></li><li>CLI:<ol><li>创建防火墙策略成功。|||||
|01011103|创建防火墙|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙】按钮进入；</li><li>进入防火墙创建界面，点击创建防火墙按钮弹出添加防火墙窗口；</li><li>名称填写“firewall”，策略在下拉菜单中选择一个可用策略，点击添加按钮，防火墙创建成功。</li></ol></li><li>CLI:<ol><li>登录到controller节点</li><li>执行命令<code>neutron firewall-create POLICY-ID</code>|<ul><li>UI:<ol><li>创建防火墙成功。</li></ol></li><li>CLI:<ol><li>创建防火墙成功。|||||
|01011104|修改防火墙规则|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙规则】按钮进入；</li><li>进入防火墙规则界面，点击需要修改的防火墙规则，点击按钮编辑规则，弹出编辑规则对话框；</li><li>协议修改为“UDP”，目的端口修改为“69”，点击保存；</li></ol></li><li>CLI:<ol><li>登录到controller节点；</li><li>执行命令：</code>neutron firewall-rule-update RULE-NAME --protocol UDP NAME/ID<code>|<ul><li>UI:<ol><li>修改防火墙规则成功。</li></ol></li><li>CLI:<ol><li>修改防火墙规则成功。||命令修改规则功能较弱只能更新协议一项内容|||
|01011105|修改防火墙策略|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击防火策略按钮选定需要修改的防火墙策略；</li><li>点击编辑策略按钮，弹出策略对话框，修改名称；</li><li>点击对应策略下拉菜单，插入规则弹出策略中添加规则对话框，选择需要插入的规则，点击保存。</li></ol></li><li>CLI:<ol><li>登录到controller节点；</li><li>执行命令更策略：neutron firewall-policy-update POLICY-NAME --name UPDATE-NAME</code>；</li><li>执行命名往策略中增加规则：<code> neutron firewall-policy-insert-rule POLICY-ID RULE-ID</code>；</li><li>执行命令将策略中的规则删除：<code>neutron firewall-policy-remove-rule POLICY-ID RULE-ID</code>|<ul><li>UI:<ol><li>修改防火墙策略成功。</li></ol></li><li>CLI:<ol><li>修改防火墙策略成功。||修改防火墙策略可以包括修改名称，插入，移除规则等|||
|01011106|修改防火墙|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击防火墙按钮，点击编辑防火墙，弹出编辑防火墙对话框；</li><li>修改名称“firewall2”，修改策略选择需要的策略，点击保存。。</li></ol></li><li>CLI:<ol><li>登录到controller节点；</li><li>执行命令：<code>neutron firewall-update FIREWALL-ID --name UPDATE-NAME</code>|<ul><li>UI:<ol><li>修改防火墙成功。</li></ol></li><li>CLI:<ol><li>修改防火墙成功。||其他命令行修改方式一样|||
|01011107|删除防火墙|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙】按钮进入；</li><li>选中需要删除的防火墙，点击按钮删除防火墙将防火墙删除。</li></ol></li><li>CLI:<ol><li>登录到controller节点上；</li><li>执行命令：<code>neutron firewall-delete FIREWALL-ID</code>|<ul><li>UI:<ol><li>删除防火墙成功。</li></ol></li><li>CLI:<ol><li>删除防火墙成功。|||||
|01011108|删除防火墙策略|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙策略】按钮进入；</li><li>选中需要删除的防火墙策略，点击按钮删除策略将策略删除。</li></ol></li><li>CLI:<ol><li>登录到controller节点上；</li><li>执行命令：<code>neutron firewall-policy-delete FIREWALL-POLICY-ID</code>|<ul><li>UI:<ol><li>删除防火墙策略成功。</li></ol></li><li>CLI:<ol><li>删除防火墙策略成功。||防火墙策略只有在其防火墙被删除之后才能成功删除|||
|01011109|删除防火墙规则|<ul><li>UI:<ol><li>登录dashboard，点击【Project】 选项，选择【Network】子选项；</li><li>点击 【Networks】 选项，点击【firewall】子选项，进入防火墙配置界面，点击【防火墙规则】按钮进入；</li><li>选中需要删除的防火墙规则，点击按钮删除归贼将规则删除。</li></ol></li><li>CLI:<ol><li>登录到controller节点上；</li><li>执行命令：<code>neutron firewall-rule-delete FIREWALL-RULE-ID</code>|<ul><li>UI:<ol><li>删除防火墙规则成功。</li></ol></li><li>CLI:<ol><li>删除防火墙规则成功。||规则只有在其所在的防火墙策略被删除后才能删除|||
|01011110|验证防火墙|<ul><li>UI:<ol><li>登录dashboard，点击【Project】选项，选择【Compute】子选项；</li><li>点击【实例】选项分别选定两个不再同一个子网的实例点击进入虚拟机详情，点击控制台进入虚拟控制台；</li><li>在实例的虚拟控制台中，两台虚拟机按照防火墙的规则通信。</li></ol></li><li>CLI:<ol><li>|不同网段的虚拟机能够按照防火规则通信|||||
|01011111|测试创建防火墙时指定路由|<ul><li>CLI:<ol><li>登录到 Controller 节点；</li><li>执行命令 <code>neutron firewall-create TODO --fw_target_routers list=true [ROUTER_ID1] [ROUTER_ID2]</code> 创建指定路由的防火墙，其中 ROUTER_ID1 和 ROUTER_ID2 为所指定的路由，路由可以指定多个。</li></ol></li></ul>|<ul><li>CLI:<ul><li>成功创建指定路由的防火墙</li><li>防火墙对创建时所指定的路由表生效</li><li>将不在路由表里的路由指定给云主机，则云主机没有防火墙</li></ul></li></ul>|||None|
|01011112|测试更新防火墙的目标路由表|<ul><li>CLI:<ol><li>登录到 Controller 节点；</li><li>执行命令 <code>neutron firewall-update [FW_ID] --fw_target_routers list=true [NEW_ROUTER_ID1] [NEW_ROUTER_ID2]...</code> 更新路由表，其中 NEW_ROUTER_ID1 和 NEW_ROUTER_ID2 为新的路由 ID，可以指定多个。</li></ol></li></ul>|<ul><li>CLI:<ul><li>成功更新防火墙的路由表</li><li>防火墙对新的路由表生效</li></ul></li></ul>|||None|
|01011113|测试清空防火墙的目标路由表|<ul><li>CLI:<ol><li>登录到 Controller 节点；</li><li>执行命令 <code>neutron firewall-update [FW_ID] --fw_target_routers action=clear</code> 清除防火墙路由表。</li></ol></li></ul>|<ul><li>CLI:<ul><li>成功清空防火墙的目标路由表</li><li>防火墙对整个租户生效，而不止是对某（几）个路由生效</li></ul></li></ul>|||None|
