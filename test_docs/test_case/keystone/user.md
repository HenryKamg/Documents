# 验证 keystone 的 user 部分

|内容编号|内容名称|
|--------|--------|
|02|用户|

|测试编号|测试目的|操作|预期结果|实际结果|备注|Rally/Tempest/None|
|--------|--------|----|--------|--------|----|------------------|
|01040201|列出 user|<ul><li>UI:<ol><li>登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项。</li></ol></li><li>CLI:<ol><li>登录到 Rally 测试服务器；</li><li>使用测试文件 create-and-list-users.yaml；</li><li>执行测试命令 <code>rally task start create-and-list-users.yaml</code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>右侧列出所有的用户的信息</li></ul></li><li>CLI:<ul><li>Rally 测试成功</li></ul></li></ul>||<ul><li>设置名称长度为 10</li><li>执行 100 次，每次并行执行 10 个测试</li></ul>|Rally:</br>create-and-list-users.yaml|
|01040202|创建 user|<ul><li>UI:<ol><li>登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项，点击右侧的 【Create User】】 按钮；</li><li>在弹出的 【Create User】】 窗口中，填写 Name，Email，Password，Confirm Password，选择 Primary Project 和 Role；</li><li>点击窗口下方的 【Create User】 按钮。</li></ol></li><li>CLI:<ol><li>登录到 Rally 测试服务器；</li><li>使用测试文件 create-user.yaml；</li><li>执行测试命令 <code>rally task start create-user.yaml</code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>用户创建成功</li></ul></li><li>CLI:<ul><li>Rally 测试成功</li></ul></li></ul>||<ul><li>设置名称长度为 10</li><li>执行 100 次，每次并行执行 10 个测试</li></ul>|Rally:</br>create-user.yaml|
|01040203|普通用户列出 user|<ul><li>UI:<ol><li>使用普通用户登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项。</li></ol></li><li>CLI:<ol><li>登录到 Controller 节点；</li><li>使用 OpenStack 的普通用户，执行命令 <code>keystone keystone user-create --name \<user-name\></code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>跳转到错误页面</li><li>提示错误信息为："You do not have permission to access the resource:/dashboard/identity/users/"</li></ul></li><li>CLI:<ul><li>命令执行不成功</li><li>提示错误信息为："You are not authorized to perform the requested action: admin_required (HTTP 403)"</li></ul></li></ul>|||None|
|01040204|普通用户创建 user|<ul><li>UI:<ol><li>使用普通用户登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项。</li></ol></li><li>CLI:<ol><li>登录到 Controller 节点；</li><li>使用 OpenStack 的普通用户，执行命令 <code>keystone keystone user-create --name \<user-name\></code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>跳转到错误页面</li><li>提示错误信息为："You do not have permission to access the resource:/dashboard/identity/users/"</li></ul></li><li>CLI:<ul><li>命令执行不成功</li><li>提示错误信息为："You are not authorized to perform the requested action: admin_required (HTTP 403)"</li></ul></li></ul>|||None|
|01040205|删除 user|<ul><li>UI:<ul><li>登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项，选择一个要删除的用户，点击 【Actions】 中的 【Delete User】；</li><li>在弹出的 【Confirm Delete User】 窗口中，点击窗口下方的 【Delete User】 按钮。</li></ol></li><li>CLI:<ol><li>登录到 Rally 测试服务器；</li><li>使用测试文件 create-and-delete-user.yaml；</li><li>执行测试命令 <code>rally task start create-and-delete-user.yaml</code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>删除用户成功，有 Success 的信息提示</li></ul></li><li>CLI:<ul><li>Rally 测试成功</li></ul></li></ul>||<ul><li>设置名称长度为 10</li><li>执行 100 次，每次并行执行 10 个测试</li></ul>|Rally:</br>create-and-delete-user.yaml|
|01040206|普通用户删除 user|<ul><li>UI:<ol><li>使用普通用户登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Users】 选项。</li></ol></li><li>CLI:<ol><li>登录到 Controller 节点；</li><li>使用 OpenStack 的普通用户，执行命令 <code>keystone keystone user-delete \<user_id or user_name\></code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>跳转到错误页面</li><li>提示错误信息为："You do not have permission to access the resource:/dashboard/identity/users/"</li></ul></li><li>CLI:<ul><li>命令执行不成功</li><li>提示错误信息为："You are not authorized to perform the requested action: admin_required (HTTP 403)"</li></ul></li></ul>||||
|01040207|将一个用户添加到不同的租户中|<ul><li>UI:<ol><li>以 admin 身份登录到 dashboard；</li><li>点击左侧导航栏的 【Identity】，展开选项卡；</li><li>点击 【Projects】 选项，在右侧 project 列表中选择一个项目，点击 【Actions】 中的 【Modify Users】；</li><li>弹出 【Edit Project】 窗口，在 【Project Members】 标签下，在左侧选择一个用户 "eayunstack"，点击用户后的 【+】 图标，将 "eayunstack" 用户添加到右侧，即将用户添加到该项目中；</li><li>点击窗口下方的 【Save】 按钮，保存设置；</li><li>选择另一个项目，点击该项目后的 【Actions】 中的 【Modify Users】；</li><li>弹出 【Edit Project】 窗口，在 【Project Members】 标签下，在左侧选择 "eayunstack" 这个用户，点击用户后的 【+】 图标，将用户添加到该项目中；</li><li>点击窗口下方的 【Save】 按钮，保存设置。</li></ol></li><li>CLI:<ol><li>登录到 controller 节点；</li><li>以 admin 身份执行命令 <code>keystone user-role-add --user eayunstack --role \<role_name\> --tenant tenant1</code>；</li><li>命令执行完成后，再次执行命令 <code>keystone user-role-add --user eayunstack --role \<role_name\> --tenant tenant2</code>。</li></ol></li></ul>|<ul><li>UI:<ul><li>用户添加到第一个租户成功</li><li>用户添加到第二个租户成功</li><li>用该用户登录 dashboard，看到左上角显示的是用户的主项目，可以点击下拉图标，切换项目</li></ul></li><li>CLI:<ul><li>两个命令均执行成功，用户被添加到所指定的两个项目中</li></ul></li></ul>|||None|
