# 测试分析

## 云主机性能测试分析

### 云主机存储

测试结果显示：

* Ceph 存储的 IOPS 在顺序写模式下最高可达到 5694，在顺序读模式最高可达到 9683；而在随机写模式下最高仅为 659，在随机读模式下最高为 5278。
* Eqlx 存储的 IOPS 在顺序写模式下最高可达到 51315，在顺序读模式最高可达到 29773；而在随机写模式下最高可达到 21184，在随机读模式下最高可达到 20341。

根据云主机存储的测试结果，Ceph 存储的 IOPS 比较低，甚至在随机写模式下最高仅 659。

通过查看完整测试结果可知，在队列深度较小的情况下，Ceph 盘的利用率已经很高(超过 95%)，因此，当队列深度增加时，IOPS 变化不大。

> 根据测试结果，**Ceph 存储性能需要调式和优化**。

### 云主机网络

TCP 测试结果在正常范围之内，但 UDP 测试结果异常，初步认为与测试工具有关。

> 由于云主机网络性能受其他因素影响较大，需要继续测试，并使用不同测试工具进行测试。

## EayunStack 环境性能测试分析

### Nova 组件创建云主机性能测试分析

### Cinder 组件创建卷性能测试分析

对于创建空卷，测试结果显示：

* 创建空卷所需时间与卷的类型无关，二者性能无差别；
* 从镜像创建卷时，Ceph 与 Eqlx 类型对比，Eqlx 类型的卷相当费时，原因解释如下：

  * EayunStack 的镜像存放在 Ceph 中，通过 Ceph 创建卷时，直接从 Ceph 中读取镜像即可；
  * 当创建 Eqlx 类型的卷时，在没有 Cache 的情况下，需要先将镜像从 Ceph 节点下载到 Controller 节点，再从 Controller 节点下载到 Cinder 中，才能建卷（如果加了 Cache，则**可能**没有 Ceph 到 Controller 节点的过程）；
  * 综上，创建 Eqlx 卷的过程增加了镜像的下载过程，因此花费大量的时间在镜像的下载上，导致了建卷的速度大大降低。

* 对于 Ceph 类型的卷，创建空卷所用的时间与从镜像创建卷所用的时间基本相同，原因如上所述；

### Glance 组件上传镜像性能测试分析

测试结果中的趋势线的斜率表示 Glance 上传镜像的速度，那么，我们知道：

* Glance 组件上传镜像的速度相对稳定；
* Glance 组件上传镜像的速度为 9.4Mb/s 左右。
  * 计算公式为：(16 - 2) \* 1024 / (1490.692 - 189.557) = 9.444 Mb/s
